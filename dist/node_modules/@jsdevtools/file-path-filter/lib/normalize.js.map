{"version":3,"file":"normalize.js","sources":["../../../../../node_modules/@jsdevtools/file-path-filter/lib/normalize.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.normalize = void 0;\nconst globToRegExp = require(\"glob-to-regexp\");\nconst path = require(\"path\");\nconst util_1 = require(\"./util\");\n/**\n * Normalizes the user-provided filter criteria. The normalized form is a `Filters` object\n * whose `include` and `exclude` properties are both `FilterFunction` arrays.\n */\nfunction normalize(criteria, opts) {\n    let filters = {\n        include: [],\n        exclude: [],\n    };\n    let options = normalizeOptions(opts);\n    // Convert each criterion to a FilterFunction\n    let tuples = normalizeCriteria(criteria, options);\n    // Populate the `include` and `exclude` arrays\n    for (let [filter, filterFunction] of tuples) {\n        filters[filter].push(filterFunction);\n    }\n    return filters;\n}\nexports.normalize = normalize;\n/**\n * Fills-in defaults for any options that weren't specified by the caller.\n */\nfunction normalizeOptions(options) {\n    return {\n        // TODO: Remove the \"getPath\" fallback in the next minor release\n        map: options.map || options.getPath || String,\n        sep: options.sep || path.sep,\n    };\n}\n/**\n * Creates a `FilterFunction` for each given criterion.\n */\nfunction normalizeCriteria(criteria, options, filter) {\n    let tuples = [];\n    if (Array.isArray(criteria)) {\n        for (let criterion of criteria) {\n            tuples.push(...normalizeCriteria(criterion, options, filter));\n        }\n    }\n    else if (util_1.isPathFilter(criteria)) {\n        for (let filterFunction of criteria[util_1._filters].include) {\n            tuples.push([\"include\", filterFunction]);\n        }\n        for (let filterFunction of criteria[util_1._filters].exclude) {\n            tuples.push([\"exclude\", filterFunction]);\n        }\n    }\n    else if (util_1.isFilterCriterion(criteria)) {\n        tuples.push(normalizeCriterion(criteria, options, filter));\n    }\n    else if (criteria && typeof criteria === \"object\" && !filter) {\n        if (criteria.include !== undefined) {\n            tuples.push(...normalizeCriteria(criteria.include, options, \"include\"));\n        }\n        if (criteria.exclude !== undefined) {\n            tuples.push(...normalizeCriteria(criteria.exclude, options, \"exclude\"));\n        }\n    }\n    else {\n        throw new Error(`Invalid filter criteria: ${criteria}`);\n    }\n    return tuples;\n}\n/**\n * Creates a `FilterFunction` for the given criterion.\n *\n * @param criteria - One or more filter critiera\n * @param options - Options for how the `FilterFunction` should behave\n * @param filter - The type of filter. Defaults to `include`, except for glob patterns that start with \"!\"\n */\nfunction normalizeCriterion(criterion, options, filter) {\n    const globOptions = { extended: true, globstar: true };\n    let type = typeof criterion;\n    let filterFunction;\n    if (type === \"function\") {\n        filterFunction = criterion;\n    }\n    else if (type === \"boolean\") {\n        let bool = criterion;\n        filterFunction = function booleanFilter() {\n            return bool;\n        };\n    }\n    else if (type === \"string\") {\n        let glob = criterion;\n        let invert = false;\n        if (glob.startsWith(\"!\")) {\n            glob = glob.substr(1);\n            invert = Boolean(filter);\n            filter = filter || \"exclude\";\n        }\n        let pattern = globToRegExp(glob, globOptions);\n        filterFunction = createGlobFilter(pattern, options, invert);\n    }\n    else if (criterion instanceof RegExp) {\n        let pattern = criterion;\n        let { map } = options;\n        filterFunction = function regExpFilter(...args) {\n            let filePath = map(...args);\n            return pattern.test(filePath);\n        };\n    }\n    else {\n        throw new Error(`Invalid filter criteria: ${criterion}`);\n    }\n    return [filter || \"include\", filterFunction];\n}\n/**\n * Creates a `FilterFunction` for filtering based on glob patterns\n */\nfunction createGlobFilter(pattern, options, invert) {\n    let { map, sep } = options;\n    return function globFilter(...args) {\n        let filePath = map(...args);\n        if (sep !== \"/\") {\n            // Glob patterns always expect forward slashes, even on Windows\n            filePath = filePath.replace(new RegExp(\"\\\\\" + sep, \"g\"), \"/\");\n        }\n        let match = pattern.test(filePath);\n        return invert ? !match : match;\n    };\n}\n//# sourceMappingURL=normalize.js.map"],"names":["normalize_1","require$$0","require$$2"],"mappings":"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"}