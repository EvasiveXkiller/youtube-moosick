{"version":3,"file":"index.js","sources":["../../../../../../node_modules/@jsdevtools/readdir-enhanced/lib/iterator/index.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.readdirIterator = void 0;\nconst fs = require(\"fs\");\nconst for_each_1 = require(\"../async/for-each\");\nconst directory_reader_1 = require(\"../directory-reader\");\nconst pending_1 = require(\"./pending\");\nconst iteratorFacade = { fs, forEach: for_each_1.asyncForEach };\nfunction readdirIterator(dir, options) {\n    let reader = new directory_reader_1.DirectoryReader(dir, options, iteratorFacade);\n    let stream = reader.stream;\n    let pendingValues = [];\n    let pendingReads = [];\n    let error;\n    let readable = false;\n    let done = false;\n    stream.on(\"error\", function streamError(err) {\n        error = err;\n        stream.pause();\n        fulfillPendingReads();\n    });\n    stream.on(\"end\", function streamEnd() {\n        done = true;\n        fulfillPendingReads();\n    });\n    stream.on(\"readable\", function streamReadable() {\n        readable = true;\n        fulfillPendingReads();\n    });\n    return {\n        [Symbol.asyncIterator]() {\n            return this;\n        },\n        next() {\n            let pendingRead = pending_1.pending();\n            pendingReads.push(pendingRead);\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            Promise.resolve().then(fulfillPendingReads);\n            return pendingRead.promise;\n        }\n    };\n    function fulfillPendingReads() {\n        if (error) {\n            while (pendingReads.length > 0) {\n                let pendingRead = pendingReads.shift();\n                pendingRead.reject(error);\n            }\n        }\n        else if (pendingReads.length > 0) {\n            while (pendingReads.length > 0) {\n                let pendingRead = pendingReads.shift();\n                let value = getNextValue();\n                if (value) {\n                    pendingRead.resolve({ value });\n                }\n                else if (done) {\n                    pendingRead.resolve({ done, value });\n                }\n                else {\n                    pendingReads.unshift(pendingRead);\n                    break;\n                }\n            }\n        }\n    }\n    function getNextValue() {\n        let value = pendingValues.shift();\n        if (value) {\n            return value;\n        }\n        else if (readable) {\n            readable = false;\n            while (true) {\n                value = stream.read();\n                if (value) {\n                    pendingValues.push(value);\n                }\n                else {\n                    break;\n                }\n            }\n            return pendingValues.shift();\n        }\n    }\n}\nexports.readdirIterator = readdirIterator;\n//# sourceMappingURL=index.js.map"],"names":["require$$1","require$$2","require$$3"],"mappings":"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"}