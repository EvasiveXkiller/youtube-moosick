{"version":3,"file":"parser.js","sources":["../../../../../node_modules/object-scan/lib/core/parser.js"],"sourcesContent":["\"use strict\";\n\nconst {\n  Wildcard\n} = require('./wildcard');\n\nconst Result = require('./parser-result');\n\nconst throwError = (msg, input, context = {}) => {\n  throw new Error(Object.entries(context).reduce((p, [k, v]) => `${p}, ${k} ${v}`, `${msg}: ${input}`));\n};\n\nmodule.exports.parse = (input, ctx) => {\n  if (input === '') {\n    return new Wildcard('', false);\n  }\n\n  const result = Result(input);\n  const inputLength = input.length;\n  let escaped = false;\n  let bracketDepth = 0;\n\n  for (let idx = 0; idx < inputLength; idx += 1) {\n    const char = input[idx];\n\n    if (escaped === false && bracketDepth === 0) {\n      switch (char) {\n        case '.':\n          result.finishElement(idx, {\n            err: 'Bad Path Separator',\n            fins: [']', '}']\n          });\n          break;\n\n        case '[':\n          if (!ctx.useArraySelector) {\n            throwError('Forbidden Array Selector', input, {\n              char: idx\n            });\n          }\n\n          result.finishElement(idx, {\n            err: 'Bad Array Start',\n            fins: [null, '!', '{', ',', '}', ']']\n          });\n          result.setInArray(true, idx);\n          break;\n\n        case ']':\n          result.finishElement(idx, {\n            err: 'Bad Array Terminator',\n            fins: ['}']\n          });\n          result.setInArray(false, idx);\n          break;\n\n        case '{':\n          result.finishElement(idx, {\n            err: 'Bad Group Start',\n            fins: [null, '!', '.', '[', '{', ','],\n            finReq: true\n          });\n          result.startGroup();\n          break;\n\n        case ',':\n          result.finishElement(idx, {\n            err: 'Bad Group Separator',\n            fins: [']', '}']\n          });\n          result.newGroupElement();\n          break;\n\n        case '}':\n          result.finishElement(idx, {\n            err: 'Bad Group Terminator',\n            fins: [']', '}']\n          });\n          result.finishGroup(idx);\n          break;\n\n        case '!':\n          result.finishElement(idx, {\n            err: 'Bad Exclusion',\n            fins: [null, '.', ',', '{', '['],\n            finReq: true\n          });\n          result.startExclusion(idx);\n          break;\n\n        default:\n          break;\n      }\n    }\n\n    if (escaped === false) {\n      switch (char) {\n        case '(':\n          bracketDepth += 1;\n          break;\n\n        case ')':\n          if (bracketDepth === 0) {\n            throwError('Unexpected Parentheses', input, {\n              char: idx\n            });\n          }\n\n          bracketDepth -= 1;\n          break;\n\n        default:\n          break;\n      }\n    }\n\n    escaped = char === '\\\\' ? !escaped : false;\n  }\n\n  if (escaped !== false) {\n    throwError('Dangling Escape', input, {\n      char: inputLength - 1\n    });\n  }\n\n  if (bracketDepth !== 0) {\n    throwError('Unterminated Parentheses', input);\n  }\n\n  result.finishElement(inputLength, {\n    err: 'Bad Terminator',\n    fins: [']', '}']\n  });\n  return result.finalizeResult();\n};"],"names":["require$$0","require$$1"],"mappings":"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"}