{"version":3,"file":"wildcard.js","sources":["../../../../../node_modules/object-scan/lib/core/wildcard.js"],"sourcesContent":["\"use strict\";\n\nconst {\n  escapeRegex,\n  asRegex\n} = require('../generic/helper');\n\nconst parseWildcard = str => {\n  let regex = '';\n  let escaped = false;\n\n  for (let idx = 0; idx < str.length; idx += 1) {\n    const char = str[idx];\n\n    if (!escaped && char === '\\\\') {\n      escaped = true;\n    } else if (!escaped && char === '*') {\n      regex += '.*';\n    } else if (!escaped && char === '+') {\n      regex += '.+';\n    } else if (!escaped && char === '?') {\n      regex += '.';\n    } else {\n      regex += escapeRegex(char);\n      escaped = false;\n    }\n  }\n\n  return new RegExp(`^${regex}$`);\n};\n\nmodule.exports.parseWildcard = parseWildcard;\n\nconst compileWildcard = str => {\n  if (['**', '++'].includes(str)) {\n    return asRegex('.*');\n  }\n\n  if ((str.startsWith('**(') || str.startsWith('++(')) && str.endsWith(')')) {\n    return asRegex(str.slice(3, -1));\n  }\n\n  if (str.startsWith('[(') && str.endsWith(')]')) {\n    return asRegex(str.slice(2, -2));\n  }\n\n  if (str.startsWith('(') && str.endsWith(')')) {\n    return asRegex(str.slice(1, -1));\n  }\n\n  if (str.startsWith('[') && str.endsWith(']')) {\n    return parseWildcard(str.slice(1, -1));\n  }\n\n  return parseWildcard(str);\n};\n\nclass Wildcard {\n  constructor(value, excluded) {\n    this.value = value;\n    this.excluded = excluded;\n    this.regex = compileWildcard(value);\n    this.isArrayTarget = value.startsWith('[') && value.endsWith(']');\n    this.isSimpleStarRec = value === '**';\n    this.isSimplePlusRec = value === '++';\n    this.isSimpleRec = this.isSimpleStarRec || this.isSimplePlusRec;\n    this.isRegexStarRec = value.startsWith('**(') && value.endsWith(')');\n    this.isRegexPlusRec = value.startsWith('++(') && value.endsWith(')');\n    this.isRegexRec = this.isRegexStarRec || this.isRegexPlusRec;\n    this.isStarRec = this.isSimpleStarRec || this.isRegexStarRec;\n    this.isPlusRec = this.isSimplePlusRec || this.isRegexPlusRec;\n    this.isRec = this.isStarRec || this.isPlusRec;\n    this.isAnyArrayTarget = value === '[*]';\n    this.isAnyObjTarget = value === '*';\n  }\n\n  anyMatch(key) {\n    if (!this.isRec) {\n      return false;\n    }\n\n    if (this.isSimpleRec) {\n      return true;\n    }\n\n    return this.regex.test(key);\n  }\n\n  typeMatch(key, isArray) {\n    if (this.isSimpleRec) {\n      return true;\n    }\n\n    if (isArray && this.isAnyArrayTarget) {\n      return true;\n    }\n\n    if (!isArray && this.isAnyObjTarget) {\n      return true;\n    }\n\n    if (isArray !== this.isArrayTarget && !this.isRec) {\n      return false;\n    }\n\n    return this.regex.test(key);\n  }\n\n}\n\nmodule.exports.Wildcard = Wildcard;"],"names":["require$$0"],"mappings":"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"}